<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>OpenRailwayMap Exporter: A Rust-based Railway Data Retrieval and Visualization Tool</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="chapter_1.html"><strong aria-hidden="true">2.</strong> Chapter 1: Getting Started</a></li><li class="chapter-item expanded "><a href="chapter_2.html"><strong aria-hidden="true">3.</strong> Chapter 2: Web App</a></li><li class="chapter-item expanded "><a href="chapter_3.html"><strong aria-hidden="true">4.</strong> Chapter 3: The Railway Graph Importer</a></li><li class="chapter-item expanded "><a href="chapter_4.html"><strong aria-hidden="true">5.</strong> Chapter 4: Downloading Railway Graphs from OpenStreetMap</a></li><li class="chapter-item expanded "><a href="chapter_5.html"><strong aria-hidden="true">6.</strong> Chapter 5: Python Bindings for OpenRailwayMap Exporter</a></li><li class="chapter-item expanded "><a href="chapter_6.html"><strong aria-hidden="true">7.</strong> Chapter 6: Railway Model</a></li><li class="chapter-item expanded "><a href="chapter_7.html"><strong aria-hidden="true">8.</strong> Chapter 7: The Railway Simulation</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OpenRailwayMap Exporter: A Rust-based Railway Data Retrieval and Visualization Tool</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Welcome to the OpenRailwayMap Exporter documentation! This Rust-based tool retrieves railway data from OpenRailwayMap using the Overpass API and exports it into a custom format. It offers a command-line interface, web app, 3D visualization, Python bindings, and more.</p>
<p><img src="https://www.plantuml.com/plantuml/proxy?cache=no&amp;src=https://raw.githubusercontent.com/chriamue/openrailwaymap-exporter/main/docs/src/overview.puml" alt="Overview" /></p>
<p>In this documentation, you'll learn how to install and use OpenRailwayMap Exporter, as well as how to integrate it with other tools and platforms. We will cover topics such as installation, usage, command-line options, web app, 3D visualization, Python bindings, Jupyter Notebook, profiling, benchmarking, and contributing to the project.</p>
<p>Let's get started!</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="chapter-1-getting-started"><a class="header" href="#chapter-1-getting-started">Chapter 1: Getting Started</a></h1>
<p>This chapter covers the basics of using the OpenRailwayMap Exporter. It will guide you through the installation process and demonstrate how to run the tool to retrieve railway data. Additionally, you will learn about the available command-line options and how to use them effectively.</p>
<h2 id="11-installation"><a class="header" href="#11-installation">1.1 Installation</a></h2>
<p>To install OpenRailwayMap Exporter, you need to have Rust and Cargo installed on your system. If you haven't installed them yet, visit the <a href="https://www.rust-lang.org/tools/install">official Rust website</a> and follow the installation instructions for your operating system.</p>
<p>Once you have Rust and Cargo installed, you can clone the OpenRailwayMap Exporter repository from GitHub:</p>
<pre><code class="language-sh">git clone https://github.com/chriamue/openrailwaymap-exporter.git
</code></pre>
<p>Navigate to the repository folder and build the project:</p>
<pre><code class="language-sh">cd openrailwaymap-exporter
cargo build --release
</code></pre>
<p>After the build process is complete, you will find the compiled binary in the <code>target/release</code> folder.</p>
<h2 id="12-basic-usage"><a class="header" href="#12-basic-usage">1.2 Basic Usage</a></h2>
<p>Now that you have successfully built the OpenRailwayMap Exporter, you can start using it to download railway data.</p>
<p>To download railway data within a bounding box around a specific location, run the following command:</p>
<pre><code class="language-sh">cargo run -- --bbox &quot;latitude_min,longitude_min,latitude_max,longitude_max&quot;
</code></pre>
<p>Alternatively, you can download railway data for a specific area by running:</p>
<pre><code class="language-sh">cargo run -- --area &quot;Area Name&quot;
</code></pre>
<p>Refer to the main documentation for more examples and detailed usage instructions.</p>
<h2 id="13-command-line-options"><a class="header" href="#13-command-line-options">1.3 Command-Line Options</a></h2>
<p>OpenRailwayMap Exporter offers several command-line options that allow you to customize the output format and destination, as well as enable additional features. For a comprehensive list of command-line options and their usage, refer to the main documentation.</p>
<p>Some of the available command-line options include:</p>
<ul>
<li><code>-j</code>: Save the downloaded elements in a JSON file.</li>
<li><code>-d</code>: Save the railway graph in Graphviz format.</li>
<li><code>--svg</code>: Save the railway graph as an SVG image.</li>
<li><code>-o</code>: Specify the output file name.</li>
</ul>
<p>For more information on using these options and others, consult the main documentation.</p>
<p>In the next chapter, we will explore the web application.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="chapter-2-web-app"><a class="header" href="#chapter-2-web-app">Chapter 2: Web App</a></h1>
<p>In this chapter, we will cover how to use the OpenRailwayMap Exporter web app to visualize and interact with the downloaded railway data in a browser environment.</p>
<h2 id="21-compiling-to-webassembly-wasm"><a class="header" href="#21-compiling-to-webassembly-wasm">2.1 Compiling to WebAssembly (WASM)</a></h2>
<p>To run the web app, you'll first need to compile the OpenRailwayMap Exporter to WebAssembly (WASM) using the following command:</p>
<pre><code class="language-sh">wasm-pack build --target web
</code></pre>
<p>This command will generate a <code>pkg</code> folder containing the compiled WASM files, JavaScript bindings, and other necessary files.</p>
<h2 id="22-running-the-web-app"><a class="header" href="#22-running-the-web-app">2.2 Running the Web App</a></h2>
<p>After compiling the project to WASM, you can run the web app using a local web server. In this example, we'll use Python's built-in HTTP server. If you don't have Python installed, you can download it from the official Python website.</p>
<p>Run the following command to start the HTTP server:</p>
<pre><code class="language-sh">python3 -m http.server
</code></pre>
<p>This command will start the server on port 8000 by default. If you want to use a different port, simply add the desired port number at the end of the command, like this:</p>
<pre><code class="language-sh">python3 -m http.server 8080
</code></pre>
<h2 id="23-accessing-the-web-app-in-your-browser"><a class="header" href="#23-accessing-the-web-app-in-your-browser">2.3 Accessing the Web App in Your Browser</a></h2>
<p>Once the HTTP server is running, open your browser and navigate to http://localhost:8000 (or replace 8000 with the port number you used). You should see the OpenRailwayMap Exporter web app in your browser.</p>
<p>From the web app, you can download railway data, visualize it on a map, and interact with the railway elements. You can also customize the appearance of the map, such as the colors and line styles, to better visualize the railway data.</p>
<p>In the next chapter, we'll explore the 3D visualization capabilities of the OpenRailwayMap Exporter.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="chapter-3-the-railway-graph-importer"><a class="header" href="#chapter-3-the-railway-graph-importer">Chapter 3: The Railway Graph Importer</a></h1>
<p>In this chapter, we will discuss the Railway Graph Importer, a core component of the OpenRailwayMap Exporter that is responsible for importing railway graph data from different formats and sources.</p>
<h2 id="31-understanding-the-railway-graph-importer"><a class="header" href="#31-understanding-the-railway-graph-importer">3.1 Understanding the Railway Graph Importer</a></h2>
<p>The Railway Graph Importer is a module that defines a trait called <code>RailwayGraphImporter</code>. This trait provides a unified interface for importing railway graph data from various sources and formats, such as JSON, XML, or other custom formats. By implementing this trait, developers can create custom importers that seamlessly integrate with the OpenRailwayMap Exporter.</p>
<p>The <code>RailwayGraphImporter</code> trait has a single method, <code>import</code>, which takes a reference to a <code>serde_json::Value</code> and returns a <code>Result&lt;RailwayGraph&gt;</code>. The method is responsible for converting the input data into a <code>RailwayGraph</code> object that can be used by the rest of the OpenRailwayMap Exporter.</p>
<h2 id="32-implementing-a-custom-railway-graph-importer"><a class="header" href="#32-implementing-a-custom-railway-graph-importer">3.2 Implementing a Custom Railway Graph Importer</a></h2>
<p>To create a custom railway graph importer, you'll need to implement the <code>RailwayGraphImporter</code> trait for your importer struct. This involves providing a definition for the <code>import</code> method that takes a <code>serde_json::Value</code> as input and returns a <code>Result&lt;RailwayGraph&gt;</code>.</p>
<p>Here's a basic outline of how you can implement the <code>RailwayGraphImporter</code> trait:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use crate::railway_model::RailwayGraph;
use crate::importer::RailwayGraphImporter;
use serde_json::Value;
use anyhow::Result;

pub struct MyCustomImporter;

impl RailwayGraphImporter for MyCustomImporter {
    fn import(input: &amp;Value) -&gt; Result&lt;RailwayGraph&gt; {
        // Your custom importer logic goes here.

        // 1. Parse the input data.
        // 2. Create a new RailwayGraph instance.
        // 3. Add nodes and edges to the RailwayGraph.
        // 4. Return the RailwayGraph wrapped in a Result.

        // Example:
        // let graph = RailwayGraph::new();
        // Ok(graph)
    }
}
<span class="boring">}</span></code></pre></pre>
<p>With your custom importer implementation, you can now use it in the OpenRailwayMap Exporter to import railway graph data from your custom format or source.</p>
<h2 id="33-using-the-overpass-importer"><a class="header" href="#33-using-the-overpass-importer">3.3 Using the Overpass Importer</a></h2>
<p>The OpenRailwayMap Exporter comes with a built-in importer called <code>OverpassImporter</code> that fetches railway data from the OpenRailwayMap using the Overpass API. This importer is an implementation of the <code>RailwayGraphImporter</code> trait and serves as an example of how to create custom importers.</p>
<p>To use the <code>OverpassImporter</code>, you can simply create a new instance of the importer and call the <code>import</code> method with the desired input data:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use crate::importer::OverpassImporter;
use serde_json::Value;

// Create a new OverpassImporter instance.
let importer = OverpassImporter::new();

// Deserialize the input data as a serde_json::Value.
let input_data: Value = serde_json::from_str(&amp;input_json)?;

// Import the railway graph using the OverpassImporter.
let railway_graph = importer.import(&amp;input_data)?;
<span class="boring">}</span></code></pre></pre>
<p>In the next chapter, we will explore the 3D visualization capabilities of the OpenRailwayMap Exporter.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="chapter-4-downloading-railway-graphs-from-openstreetmap"><a class="header" href="#chapter-4-downloading-railway-graphs-from-openstreetmap">Chapter 4: Downloading Railway Graphs from OpenStreetMap</a></h1>
<p>In this chapter, we will discuss how the OpenRailwayMap Exporter can download railway graphs from OpenStreetMap using a client that fetches data through an API.</p>
<h2 id="41-the-railway-api-client"><a class="header" href="#41-the-railway-api-client">4.1 The Railway API Client</a></h2>
<p>The OpenRailwayMap Exporter includes a module called the Railway API Client, which provides a trait and an implementation for fetching railway infrastructure data from an API. The <code>RailwayApiClient</code> trait offers a common asynchronous interface for retrieving data by area name or bounding box.</p>
<p>By implementing the <code>RailwayApiClient</code> trait, developers can create custom API clients that can fetch railway graph data from different APIs or sources. The OpenRailwayMap Exporter comes with a built-in API client called the <code>OverpassApiClient</code>, which fetches railway data from OpenStreetMap using the Overpass API.</p>
<h2 id="42-fetching-railway-data-by-area-name-or-bounding-box"><a class="header" href="#42-fetching-railway-data-by-area-name-or-bounding-box">4.2 Fetching Railway Data by Area Name or Bounding Box</a></h2>
<p>The <code>RailwayApiClient</code> trait has two primary methods for fetching railway data: <code>fetch_by_area_name</code> and <code>fetch_by_bbox</code>. The <code>fetch_by_area_name</code> method allows users to download railway data by specifying the name of an area, while the <code>fetch_by_bbox</code> method enables users to provide a bounding box to define the area of interest.</p>
<p>These methods return a JSON <code>Value</code> containing the fetched railway data, which can then be passed to a <code>RailwayGraphImporter</code> to import the railway graph data into the OpenRailwayMap Exporter.</p>
<h2 id="43-using-the-overpass-api-client"><a class="header" href="#43-using-the-overpass-api-client">4.3 Using the Overpass API Client</a></h2>
<p>To use the built-in Overpass API client, you can create a new instance of the client and connect it to the OpenRailwayMap API using the desired URL. Once connected, you can fetch railway data by area name or bounding box:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use crate::api_client::OverpassApiClient;

// Create a new OverpassApiClient instance.
let mut client = OverpassApiClient::new();

// Connect to the OpenRailwayMap API.
client.connect(&quot;https://overpass-api.de/api/interpreter&quot;).await?;

// Fetch railway data by area name or bounding box.
let area_name = &quot;Frankfurt am Main&quot;;
let bbox = &quot;49.9,8.4,50.2,8.8&quot;;

let railway_data_by_area = client.fetch_by_area_name(area_name).await?;
let railway_data_by_bbox = client.fetch_by_bbox(bbox).await?;
<span class="boring">}</span></code></pre></pre>
<p>In summary, the Railway API Client is a crucial component of the OpenRailwayMap Exporter, enabling users to fetch railway data from OpenStreetMap and other sources easily. By implementing the <code>RailwayApiClient</code> trait, developers can create custom clients that fetch railway data from different APIs or sources, providing flexibility and extensibility to the OpenRailwayMap Exporter.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="chapter-5-python-bindings-for-openrailwaymap-exporter"><a class="header" href="#chapter-5-python-bindings-for-openrailwaymap-exporter">Chapter 5: Python Bindings for OpenRailwayMap Exporter</a></h1>
<p>In this chapter, we will discuss how to use the Python bindings for the OpenRailwayMap Exporter, allowing users to interact with railway graphs and import them using Python.</p>
<h2 id="51-python-wrapper-for-overpassimporter"><a class="header" href="#51-python-wrapper-for-overpassimporter">5.1 Python Wrapper for OverpassImporter</a></h2>
<p>The OpenRailwayMap Exporter provides a Python wrapper for the <code>OverpassImporter</code> struct called <code>PyOverpassImporter</code>. This wrapper enables users to import railway graph data from a JSON string in Python. To create a new <code>PyOverpassImporter</code> instance, simply call its constructor:</p>
<pre><code class="language-python">import openrailwaymap_exporter

# Create a new PyOverpassImporter instance.
overpass_importer = openrailwaymap_exporter.PyOverpassImporter()
</code></pre>
<p>To import a railway graph from a JSON string, use the <code>import_graph</code> method:</p>
<pre><code class="language-python">input_json = &quot;...&quot;
railway_graph = overpass_importer.import_graph(input_json)
</code></pre>
<h2 id="52-python-wrapper-for-railwaygraph"><a class="header" href="#52-python-wrapper-for-railwaygraph">5.2 Python Wrapper for RailwayGraph</a></h2>
<p>The OpenRailwayMap Exporter also provides a Python wrapper for the <code>RailwayGraph</code> struct, called <code>PyRailwayGraph</code>. This wrapper allows users to interact with railway graphs in Python, providing access to the following methods:</p>
<ul>
<li><code>node_count</code>: Get the number of nodes in the railway graph.</li>
<li><code>edge_count</code>: Get the number of edges in the railway graph.</li>
<li><code>get_node_by_id</code>: Get a node by its ID from the railway graph.</li>
<li><code>get_edge_by_id</code>: Get an edge by its ID from the railway graph.</li>
</ul>
<pre><code class="language-python"># Get the number of nodes and edges in the railway graph.
node_count = railway_graph.node_count()
edge_count = railway_graph.edge_count()

# Get a node and an edge by their IDs.
node = railway_graph.get_node_by_id(node_id)
edge = railway_graph.get_edge_by_id(edge_id)
</code></pre>
<h2 id="53-exporting-railway-graphs-to-svg"><a class="header" href="#53-exporting-railway-graphs-to-svg">5.3 Exporting Railway Graphs to SVG</a></h2>
<p>The Python bindings also provide a function, <code>export_svg</code>, that generates an SVG representation of a given <code>PyRailwayGraph</code>:</p>
<pre><code class="language-python">import openrailwaymap_exporter

# Export the railway graph to an SVG string.
svg_string = openrailwaymap_exporter.export_svg(railway_graph)
</code></pre>
<h2 id="54-summary"><a class="header" href="#54-summary">5.4 Summary</a></h2>
<p>In this chapter, we have seen how the Python bindings for the OpenRailwayMap Exporter make it easy for users to interact with railway graphs and import them using Python. By providing Python wrappers for the <code>OverpassImporter</code> and <code>RailwayGraph</code> structs, along with an SVG export function, the OpenRailwayMap Exporter can be used in various Python applications, opening up new possibilities for developers and users alike.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="chapter-6-railway-model"><a class="header" href="#chapter-6-railway-model">Chapter 6: Railway Model</a></h1>
<p>The Railway Model module is a core component of the OpenRailwayMap Exporter. It provides data structures and functions for working with railway infrastructure data. The main components of this module are the RailwayNode, RailwayEdge, and RailwayGraph structs, as well as a RailwayGraphBuilder for creating RailwayGraphs from raw data.</p>
<h2 id="railwaynode"><a class="header" href="#railwaynode">RailwayNode</a></h2>
<p>RailwayNode represents a single node in the railway network. A node can represent a railway station, a junction, or any other point of interest within the railway infrastructure. Each node has a unique ID, latitude, and longitude.</p>
<h2 id="railwayedge"><a class="header" href="#railwayedge">RailwayEdge</a></h2>
<p>RailwayEdge represents a railway segment connecting two nodes in the railway network. Each edge has a unique ID, a length, and a set of attributes such as the track type, maximum speed, or electrification.</p>
<h2 id="railwaygraph"><a class="header" href="#railwaygraph">RailwayGraph</a></h2>
<p>RailwayGraph is the main data structure for representing railway networks. It is an undirected graph consisting of RailwayNode instances as nodes and RailwayEdge instances as edges. The graph also stores a HashMap that maps node IDs to their corresponding indices in the graph for easy retrieval.</p>
<p>RailwayGraph provides several methods for working with railway networks, such as:</p>
<ul>
<li>Retrieving a node or an edge by its ID</li>
<li>Retrieving the edge connecting two nodes</li>
<li>Retrieving all edges connected to a node</li>
<li>Calculating the bounding box of the graph</li>
<li>Calculating the total length of the railway network</li>
<li>Finding the nearest node to a given position on an edge</li>
</ul>
<h2 id="railwaygraphbuilder"><a class="header" href="#railwaygraphbuilder">RailwayGraphBuilder</a></h2>
<p>The RailwayGraphBuilder is a helper struct for constructing RailwayGraph instances from raw data. It provides methods for adding nodes and edges to the graph and ensures that the graph remains consistent during construction.</p>
<h1 id="usage-example"><a class="header" href="#usage-example">Usage Example</a></h1>
<p>Suppose you have imported railway infrastructure data from OpenStreetMap using the Overpass API. You can create a RailwayGraph instance from this data using the RailwayGraphBuilder, like this:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let mut builder = RailwayGraphBuilder::new();

// Add nodes and edges from the raw data
for node in raw_nodes {
    builder.add_node(node.id, node.lat, node.lon);
}
for edge in raw_edges {
    builder.add_edge(edge.id, edge.start_node_id, edge.end_node_id, edge.length, edge.attributes);
}

// Build the RailwayGraph
let railway_graph = builder.build();
<span class="boring">}</span></code></pre></pre>
<p>Now you can use the methods provided by the RailwayGraph struct to interact with the railway network. For example, you can find the nearest node to a given position on an edge like this:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let edge_id = 12345;
let position_on_edge = 0.75;
let current_node_id = Some(67890);

let nearest_node_id = railway_graph.nearest_node(edge_id, position_on_edge, current_node_id);

println!(&quot;The nearest node has ID: {}&quot;, nearest_node_id.unwrap());
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="chapter-7-the-railway-simulation"><a class="header" href="#chapter-7-the-railway-simulation">Chapter 7: The Railway Simulation</a></h1>
<p>In this chapter, we discuss the implementation of a railway simulation, which consists of a railway graph representing the infrastructure and a list of movable railway objects, such as trains, within the simulation. The simulation module provides a <code>Simulation</code> struct to manage the state of the simulation, decision agents for the objects, and metrics handlers to process events and gather metrics during the simulation run.</p>
<p>The <code>Simulation</code> struct holds a simulation environment, a list of agents, a list of metrics handlers, elapsed time of the simulation, a pause state, and a speedup factor. The environment contains a railway graph and a list of movable railway objects. Agents are used to make decisions for objects, and metrics handlers process events and gather metrics.</p>
<p>The core functionality of the simulation is implemented in several methods:</p>
<ol>
<li><code>new</code>: Creates a new simulation with the given railway graph.</li>
<li><code>get_observable_environment</code>: Returns a reference to the observable environment of the simulation, which allows external components to access the state of the simulation without being able to modify it.</li>
<li><code>add_object</code>: Adds a movable railway object to the simulation and associates a decision agent with it if provided.</li>
<li><code>remove_object</code>: Removes a movable railway object from the simulation.</li>
<li><code>add_agent_for_object</code>: Adds a decision agent for an object in the simulation.</li>
<li><code>register_metrics_handler</code>: Registers a metrics handler for the simulation.</li>
<li><code>handle_event</code>: Handles a simulation event by passing it to all registered metrics handlers.</li>
<li><code>update</code>: Updates the simulation state based on the given delta time and the speedup factor. This method is called periodically to advance the simulation.</li>
<li><code>update_object</code>: Updates the state of the object with the given id based on the given delta time. It is called internally by the <code>update</code> method.</li>
<li><code>update_object_position</code>: Updates the position of the object with the given id based on the given delta time. It is called internally by the <code>update_object</code> method.</li>
<li><code>update_train_target</code>: Updates the target of the train with the given id. It is called internally by the <code>update_object</code> method.</li>
</ol>
<p>The simulation also includes additional modules such as <code>agents</code>, <code>environment</code>, <code>commands</code>, <code>events</code>, and <code>metrics</code> to provide more specialized functionality.</p>
<p>The <code>agents</code> module contains types related to decision-making agents for the movable railway objects. The <code>environment</code> module contains types related to the simulation environment and an <code>ObservableEnvironment</code> trait to provide read-only access to the environment. The <code>commands</code> module contains types related to commands that can be issued to the movable railway objects. The <code>events</code> module contains types related to events that occur during the simulation. Finally, the <code>metrics</code> module contains types related to metrics handlers that process events and gather metrics during the simulation run.</p>
<p>In conclusion, the railway simulation module provides a comprehensive framework for creating, managing, and updating a railway simulation. The simulation consists of a railway graph, movable railway objects, decision agents, and metrics handlers to process events and gather metrics. The modular structure allows for easy extension and customization, making it a suitable choice for a wide range of railway simulation applications.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
